<form method="post" action="{% url 'note_create' %}?goal_id={{ request.GET.goal_id }}&initiative_id={{ request.GET.initiative_id }}&next={{ request.GET.next }}">
    {% csrf_token %}

    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-2 border-b bg-gray-50 rounded-t-lg">

        <h2 class="flex items-center gap-2 text-sm font-semibold text-gray-800">
            <svg class="w-5 h-5 text-gray-700" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 11v.01" />
                <path d="M8 11v.01" />
                <path d="M16 11v.01" />
                <path d="M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12" />
            </svg>
            ملاحظة جديدة
        </h2>

        <!-- Close Button -->
        <label for="note-modal-toggle" class="btn btn-sm btn-outline btn-error z-50"><svg
                xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-x">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M18 6l-12 12" />
                <path d="M6 6l12 12" />
            </svg>
        </label>

    </div>

    <!-- Note meta -->
    <div class="px-6 py-4 space-y-2">
        <!-- To -->
        <div class="flex items-center pb-3">
            <span class="text-sm font-medium text-gray-600 w-16">إلى: <span class="text-red-500">*</span></span>

            <div class="flex-1 flex items-center gap-4 flex-wrap shrink-0">
                {% if request.GET.goal_id %}
                <!-- إذا جينا من الهدف -->
                <div class="flex gap-4 items-center shrink-0">
                    <span class="font-semibold text-gray-800">
                        {{ selected_goal.goal_title }}
                    </span>
                </div>

                {% elif request.GET.initiative_id %}
                <!-- إذا جينا من initiative -->
                <div class="flex gap-4 items-center shrink-0">
                    <span class="font-semibold text-gray-800">
                        {{ selected_initiative.title }}
                    </span>
                </div>

                {% else %}
                {% if user.role.role_name == 'GM' %}
                <!-- GM send type -->
                <select id="send-type" class="select select-sm select-bordered px-4 w-64">
                    <option disabled selected>اختر نوع الإرسال</option>
                    <option value="manager">مدير إدارة</option>
                    <option value="goal">هدف</option>
                </select>

                {% elif user.role.role_name == 'M' or user.role.role_name == 'CM' %}
                <!-- Manager send type -->
                <select id="send-type" class="select select-sm select-bordered px-4 w-64">
                    <option disabled selected>اختر نوع الإرسال</option>
                    <option value="employee">موظف</option>
                    <option value="initiative">مبادرة</option>
                </select>

                {% elif user.role.role_name == 'E' %}
                <select name="initiative" class="select select-sm select-bordered px-4 w-64">
                    <option disabled selected>اختر المبادرة</option>
                    {% for initiative in form.fields.initiative.queryset %}
                    <option value="{{ initiative.id }}">
                        {{ initiative }}
                    </option>
                    {% endfor %}
                </select>
                {% endif %}
                {% endif %}



                <!-- Receiver -->
                <!-- <div id="receiver-field" class="hidden flex gap-4 items-center shrink-0">
                    <span class="text-sm font-medium text-gray-600 whitespace-nowrap">{{form.receiver.label}}<span
                            class="text-red-500"> *</span></span>
                    {{ form.receiver }}
                </div> -->
                <div id="receiver-field" class="hidden flex gap-4 items-center shrink-0">
                    <label class="text-sm font-medium text-gray-600 whitespace-nowrap">
                        {{ form.receiver.label }} <span class="text-red-500">*</span>
                    </label>

                    <select name="receiver" class="select select-sm select-bordered px-4 w-64">
                        <option disabled selected>اختر المستلم</option>
                        {% for user in form.fields.receiver.queryset %}
                        <option value="{{ user.id }}">
                            {{ user }}
                        </option>
                        {% endfor %}
                    </select>
                </div>


                <!-- Initiative -->
                <!-- <div id="initiative-field" class="hidden flex gap-4 items-center shrink-0">
                    <span
                        class="{% if user.role.role_name == 'E' %} hidden {% else %} text-sm font-medium text-gray-600 whitespace-nowrap {% endif %}">{{form.initiative.label}}<span
                            class="text-red-500"> *</span></span>
                    {{ form.initiative }}
                </div> -->

                <div id="initiative-field" class="hidden flex gap-4 items-center shrink-0">
                    <label
                        class="{% if user.role.role_name == 'E' %} hidden {% else %} text-sm font-medium text-gray-600 whitespace-nowrap {% endif %}">{{form.initiative.label}}
                        <span class="text-red-500">*</span>
                    </label>

                    <select name="initiative" class="select select-sm select-bordered px-4 w-64">
                        <option disabled selected>اختر المبادرة</option>
                        {% for initiative in form.fields.initiative.queryset %}
                        <option value="{{ initiative.id }}">
                            {{ initiative }}
                        </option>
                        {% endfor %}
                    </select>
                </div>


                <!-- Goal -->
                <!-- <div id="goal-field" class="hidden flex gap-4 items-center shrink-0">
                    <span class="text-sm font-medium text-gray-600 whitespace-nowrap">{{form.strategic_goal.label}}<span
                            class="text-red-500"> *</span></span>
                    {{ form.strategic_goal }}
                </div> -->

                <div id="goal-field" class="hidden flex gap-4 items-center shrink-0">
                    <label class="text-sm font-medium text-gray-600 whitespace-nowrap">{{form.strategic_goal.label}}
                        <span class="text-red-500">*</span>
                    </label>

                    <select name="strategic_goal" class="select select-sm select-bordered px-4 w-64">
                        <option disabled selected>اختر الهدف</option>
                        {% for goal in form.fields.strategic_goal.queryset %}
                        <option value="{{ goal.id }}">
                            {{ goal }}
                        </option>
                        {% endfor %}
                    </select>
                </div>


            </div>
        </div>

        <!-- Note title -->
        <div class="flex items-center">
            <label for="{{ form.title.id_for_label }}"
                class="text-sm font-medium text-gray-600 w-20">{{form.title.label}} <span class="text-red-500 ">
                    *</span></label>
            {{ form.title }}
        </div>

    </div>

    <!-- Divider -->
    <hr class="border-t border-gray-200">

    <!-- Note content -->
    <div class="px-6 py-4">
        <label class="block text-sm font-medium text-gray-600 mb-2">{{form.content.label}}<span class="text-red-500">
                *</span></label>
        {{ form.content }}
    </div>

    <!--Buttons container-->
    <!-- <div class="px-6 py-4 flex justify-start">
        <button type="submit" class="flex items-center gap-2 mb-2 px-6 py-2.5 text-sm font-medium rounded-lg
                            text-blue-600 border border-blue-600 hover:bg-blue-600 hover:text-white
                            shadow-sm hover:shadow-md transform hover:-translate-y-0.5
                            transition-all duration-200 focus:ring-4 focus:ring-blue-200"> -->
    <div class="px-6 py-4 flex justify-start">
        <button type="submit" class="flex items-center gap-2 mb-2 px-6 py-2.5 text-sm font-medium rounded-lg
                            text-[#00A399]/100 border border-[#00A399] hover:bg-[#00A399]/100 hover:text-white
                            shadow-sm hover:shadow-md transform hover:-translate-y-0.5
                            transition-all duration-200 focus:ring-4 focus:ring-[#018077]/30">

            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 14l11 -11" />
                <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5" />
            </svg>
            إرسال
        </button>
    </div>
</form>